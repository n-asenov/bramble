apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: loki
  namespace: monitoring
spec:
  chart:
    spec:
      chart: loki
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: grafana
        namespace: flux-system
      version: 3.3.4
  interval: 10m0s
  values:
    loki:
      auth_enabled: false
      commonConfig:
        replication_factor: 1
      storage:
        bucketNames:
          chunks: chunks
          ruler: ruler
          admin: admin
        type: s3
        s3:
          s3: null
          endpoint: http://minio.storage:9000
          region: null
          s3ForcePathStyle: true
          insecure: true
    monitoring:
      dashboards:
        labels:
          grafana_dashboard: 1
    write:
      replicas: 1
    read:
      replicas: 1
  valuesFrom:
    - kind: Secret
      name: loki-minio-credentials
      optional: false
