# apiVersion: helm.toolkit.fluxcd.io/v2beta1
# kind: HelmRelease
# metadata:
#   name: zigbee2mqtt
#   namespace: default
# spec:
#   chart:
#     spec:
#       chart: app-template
#       reconcileStrategy: ChartVersion
#       sourceRef:
#         kind: HelmRepository
#         name: bjw-s
#         namespace: flux-system
#       version: 1.1.3
#   interval: 10m0s
#   values:
#     image:
#       repository: ghcr.io/koenkk/zigbee2mqtt
#       tag: 1.28.2

#     env:
#       TZ: "Europe/Sofia"

#     securityContext:
#       privileged: true

#     service:
#       main:
#         ports:
#           http:
#             port: 8080
#           metrics:
#             enabled: true
#             port: 80
    
#     serviceMonitor:
#       main:
#         enabled: true
#         endpoints:
#           - port: metrics
#             scheme: http
#             path: /metrics
#             interval: 1m
#             scrapeTimeout: 10s

#     configMaps:
#       config:
#         enabled: true
#         data:
#           configuration.yaml: |
#             permit_join: true

#             mqtt:
#               base_topic: zigbee2mqtt
#               server: mqtt://emqx

#             serial:
#               port: /dev/ttyACM0

#             frontend: true

#             advanced:
#               network_key: GENERATE

#     ingress:
#       main:
#         enabled: true
#         hosts:
#           - host: zigbee.bramble.home
#             paths:
#               - path: /
#                 pathType: Prefix
#         tls:
#           - secretName: zigbee2mqtt-tls
#             hosts:
#               - zigbee.bramble.home

#     nodeSelector:     
#       kubernetes.io/hostname: k8s-node2

#     resources:
#       requests:
#         cpu: 10m
#         memory: 100Mi
#       limits:
#         memory: 500Mi
    
#     persistence:
#       config:
#         enabled: true
#         type: pvc
#         mountPath: /app/data
#         size: 1Gi
#       usb:
#         enabled: true
#         type: hostPath
#         hostPath: /dev/serial/by-id/usb-ITead_Sonoff_Zigbee_3.0_USB_Dongle_Plus_cc6b105fee12ec11945f20c7bd930c07-if00-port0
#         mountPath: /dev/ttyACM0
#         hostPathType: CharDevice
      
